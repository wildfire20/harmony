{"ast":null,"code":"import _objectSpread from\"C:/Users/HUAWEI/OneDrive/harmony learning institute/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import{authAPI}from'../services/api';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const token=localStorage.getItem('token');if(token){verifyToken(token);}else{setLoading(false);}},[]);const verifyToken=async token=>{try{const response=await authAPI.verifyToken(token);setUser(response.data.user);setLoading(false);}catch(error){console.error('Token verification failed:',error);localStorage.removeItem('token');setLoading(false);}};const login=async(credentials,userType)=>{try{const response=await authAPI.login(credentials,userType);const{token,user}=response.data;localStorage.setItem('token',token);setUser(user);toast.success(\"Welcome back, \".concat(user.first_name,\"!\"));return{success:true};}catch(error){var _error$response,_error$response$data;const message=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Login failed';toast.error(message);return{success:false,error:message};}};const logout=async()=>{try{await authAPI.logout();}catch(error){console.error('Logout error:',error);}finally{localStorage.removeItem('token');setUser(null);toast.success('Logged out successfully');}};const updateUser=userData=>{setUser(prev=>_objectSpread(_objectSpread({},prev),userData));};const value={user,loading,login,logout,updateUser,isAuthenticated:!!user,isStudent:(user===null||user===void 0?void 0:user.role)==='student',isTeacher:(user===null||user===void 0?void 0:user.role)==='teacher',isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'||(user===null||user===void 0?void 0:user.role)==='super_admin',isSuperAdmin:(user===null||user===void 0?void 0:user.role)==='super_admin'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","authAPI","toast","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","verifyToken","response","data","error","console","removeItem","login","credentials","userType","setItem","success","concat","first_name","_error$response","_error$response$data","message","logout","updateUser","userData","prev","_objectSpread","value","isAuthenticated","isStudent","role","isTeacher","isAdmin","isSuperAdmin","Provider"],"sources":["C:/Users/HUAWEI/OneDrive/harmony learning institute/client/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { authAPI } from '../services/api';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      verifyToken(token);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const verifyToken = async (token) => {\r\n    try {\r\n      const response = await authAPI.verifyToken(token);\r\n      setUser(response.data.user);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Token verification failed:', error);\r\n      localStorage.removeItem('token');\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (credentials, userType) => {\r\n    try {\r\n      const response = await authAPI.login(credentials, userType);\r\n      const { token, user } = response.data;\r\n      \r\n      localStorage.setItem('token', token);\r\n      setUser(user);\r\n      \r\n      toast.success(`Welcome back, ${user.first_name}!`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      const message = error.response?.data?.message || 'Login failed';\r\n      toast.error(message);\r\n      return { success: false, error: message };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await authAPI.logout();\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      localStorage.removeItem('token');\r\n      setUser(null);\r\n      toast.success('Logged out successfully');\r\n    }\r\n  };\r\n\r\n  const updateUser = (userData) => {\r\n    setUser(prev => ({ ...prev, ...userData }));\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    login,\r\n    logout,\r\n    updateUser,\r\n    isAuthenticated: !!user,\r\n    isStudent: user?.role === 'student',\r\n    isTeacher: user?.role === 'teacher',\r\n    isAdmin: user?.role === 'admin' || user?.role === 'super_admin',\r\n    isSuperAdmin: user?.role === 'super_admin',\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}